<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cook Tracker</title>
    <style>
        /* General Styles */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f5f5f5;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent; 
        }

        .main-container {
            background-color: white;
            width: 100%;
            max-width: 400px;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            font-size: 22px;
            color: #333;
            margin-bottom: 25px;
            margin-top: 10px;
        }

        /* --- SELECTOR BOXES (The Fix is Here) --- */
        .selector-box {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px 20px;
            font-size: 16px;
            color: #333;
            display: flex;
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            
            /* CRITICAL FIX: This cuts off the invisible input so it can't overlap the button below */
            overflow: hidden; 
            z-index: 1;
        }

        .arrow-icon { color: #999; font-size: 12px; pointer-events: none; }
        
        .hidden-input {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; cursor: pointer;
            z-index: 2;
        }

        /* --- COOK STATUS BUTTON --- */
        .status-card {
            /* Reset Button Styles */
            appearance: none; border: none; font-family: inherit; width: 100%;
            
            /* Visual Styles */
            background-color: #fafafa; 
            border: 2px dashed #e0e0e0; 
            border-radius: 16px;
            padding: 15px; 
            text-align: center;
            margin-top: 10px; /* Extra space from top */
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.1s ease;
            
            /* CRITICAL FIX: High Z-Index ensures it is clickable */
            position: relative;
            z-index: 100; 
        }

        .status-card:active { transform: scale(0.98); background-color: #f0f0f0; }

        .status-card .check-icon {
            background-color: #e0e0e0;
            color: white;
            width: 40px; height: 40px;
            border-radius: 8px;
            display: inline-flex; align-items: center; justify-content: center;
            font-size: 24px; margin-bottom: 8px;
            pointer-events: none; 
        }

        .status-card .status-text {
            color: #9e9e9e; font-weight: 600; font-size: 16px; display: block;
            pointer-events: none;
        }

        /* ACTIVE STATE */
        .status-card.active {
            background-color: #e8f5e9; 
            border: 2px solid #4caf50; 
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }
        .status-card.active .check-icon { background-color: #4caf50; }
        .status-card.active .status-text { color: #2e7d32; font-weight: 700; }

        /* --- SUMMARY SECTION --- */
        .section-title {
            font-size: 12px; letter-spacing: 1px; font-weight: bold;
            color: #9e9e9e; margin-bottom: 10px; text-transform: uppercase;
        }

        .summary-grid { display: flex; gap: 15px; margin-bottom: 30px; }

        .summary-box {
            flex: 1; border-radius: 16px; padding: 15px; color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; justify-content: center;
        }

        .box-visits { background: linear-gradient(135deg, #FF9800, #FF5722); }
        .box-bill { background: linear-gradient(135deg, #2979ff, #2196F3); }

        .box-label { font-size: 12px; opacity: 0.9; margin-bottom: 5px; }
        .box-value { font-size: 24px; font-weight: 700; }
        .unit { font-size: 14px; font-weight: 400; opacity: 0.8; }

        /* --- HISTORY LIST --- */
        .history-list { flex-grow: 1; padding-bottom: 50px; }
        .history-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid #f0f0f0;
        }
        .history-date { font-size: 16px; color: #555; }
        .delete-icon { 
            font-size: 20px; opacity: 0.5; cursor: pointer; padding: 10px; 
            /* High Z-Index for delete button too */
            position: relative; z-index: 50; 
        }

    </style>
</head>
<body>

    <div class="main-container">
        
        <h1>üë©‚Äçüç≥ Cook Tracker</h1>

        <div class="selector-box">
            <span id="displayDate">Loading...</span>
            <span class="arrow-icon">‚ñº</span>
            <input type="date" class="hidden-input" id="datePicker" onchange="handleDateChange()">
        </div>

        <button type="button" class="status-card" id="statusCard" onclick="toggleAttendance()">
            <div class="check-icon">‚úì</div>
            <span class="status-text" id="statusText">Mark Present</span>
        </button>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

        <div class="section-title">Monthly Report</div>

        <div class="selector-box">
            <span id="displayMonth">Loading...</span>
            <span class="arrow-icon">‚ñº</span>
            <select class="hidden-input" id="monthPicker" onchange="handleMonthChange()">
                </select>
        </div>

        <div class="summary-grid">
            <div class="summary-box box-visits">
                <span class="box-label">Total Visits</span>
                <span class="box-value"><span id="totalVisits">0</span> <span class="unit">days</span></span>
            </div>

            <div class="summary-box box-bill">
                <span class="box-label">Total Bill</span>
                <span class="box-value">‚Çπ <span id="totalBill">0</span></span>
            </div>
        </div>

        <div class="section-title">History</div>
        <div class="history-list" id="historyList"></div>

    </div>

    <script>
        let attendanceData = JSON.parse(localStorage.getItem('cookData')) || [];
        
        const datePicker = document.getElementById('datePicker');
        const monthPicker = document.getElementById('monthPicker');
        const statusCard = document.getElementById('statusCard');
        const statusText = document.getElementById('statusText');

        // Init
        const today = new Date().toISOString().split('T')[0];
        datePicker.value = today;

        populateMonthDropdown();
        updateDashboard();

        // --- FUNCTIONS ---

        function toggleAttendance() {
            const selectedDate = datePicker.value;
            const index = attendanceData.indexOf(selectedDate);

            if (index > -1) {
                attendanceData.splice(index, 1); // Remove
            } else {
                attendanceData.push(selectedDate); // Add
            }

            saveData();
            updateDashboard();
        }

        function deleteEntry(dateToDelete) {
            if(confirm("Delete entry for " + dateToDelete + "?")) {
                attendanceData = attendanceData.filter(d => d !== dateToDelete);
                saveData();
                updateDashboard();
            }
        }

        function saveData() {
            localStorage.setItem('cookData', JSON.stringify(attendanceData));
        }

        function handleDateChange() { updateDashboard(); }
        function handleMonthChange() { updateDashboard(); }

        function updateDashboard() {
            const selectedDate = datePicker.value;
            const selectedMonthVal = monthPicker.value; 

            // Text Updates
            document.getElementById('displayDate').innerText = formatDateReadable(selectedDate);
            document.getElementById('displayMonth').innerText = monthPicker.options[monthPicker.selectedIndex].text;

            // Toggle Box Visuals
            if (attendanceData.includes(selectedDate)) {
                statusCard.classList.add('active');
                statusText.innerText = "Cook Came Today";
            } else {
                statusCard.classList.remove('active');
                statusText.innerText = "Mark Present";
            }

            // Calculate Monthly Stats
            const monthVisits = attendanceData.filter(date => date.startsWith(selectedMonthVal));
            monthVisits.sort((a, b) => b.localeCompare(a));

            document.getElementById('totalVisits').innerText = monthVisits.length;
            document.getElementById('totalBill').innerText = monthVisits.length * 100;

            // Render List
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = ""; 

            monthVisits.forEach(date => {
                const itemHTML = `
                    <div class="history-item">
                        <span class="history-date">${formatDateReadable(date)}</span>
                        <span class="delete-icon" onclick="deleteEntry('${date}')">üóëÔ∏è</span>
                    </div>
                `;
                historyList.innerHTML += itemHTML;
            });
        }

        function populateMonthDropdown() {
            const current = new Date();
            for (let i = 0; i < 12; i++) {
                const d = new Date(current.getFullYear(), current.getMonth() - i, 1);
                const value = d.toISOString().slice(0, 7); 
                const text = d.toLocaleString('default', { month: 'long', year: 'numeric' });
                
                const option = document.createElement('option');
                option.value = value;
                option.text = text;
                monthPicker.appendChild(option);
            }
            monthPicker.selectedIndex = 0;
        }

        function formatDateReadable(dateString) {
            const d = new Date(dateString);
            return d.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
        }
    </script>

</body>
</html>
